把httpserver 服务以 Istio Ingress Gateway 的形式发布出来。以下是你需要考虑的几点：
如何实现安全保证；
七层路由规则；
考虑 open tracing 的接入。

前提条件：
1.使用Helm安装Istio（refer：https://istio.io/latest/docs/setup/install/helm/）
为 Istio 组件，创建命名空间 istio-system :
    $ kubectl create namespace istio-system
安装 Istio base chart，它包含了 Istio 控制平面用到的集群范围的资源：
    $ helm install istio-base manifests/charts/base -n istio-system
安装 Istio discovery chart，它用于部署 istiod 服务：
    $ helm install istiod manifests/charts/istio-control/istio-discovery \ --set global.hub="docker.io/istio" \ --set global.tag="1.13.2" \ -n istio-system
(可选项) 安装 Istio 的入站网关 chart，它包含入站网关组件：
    $ helm install istio-ingress manifests/charts/gateways/istio-ingress \ --set global.hub="docker.io/istio" \ --set global.tag="1.13.2" \ -n istio-system
(可选项) 安装 Istio 的出站网关 chart，它包含了出站网关组件：
    $ helm install istio-egress manifests/charts/gateways/istio-egress \ --set global.hub="docker.io/istio" \ --set global.tag="1.13.2" \ -n istio-system
验证安装
确认命名空间 istio-system 中所有 Kubernetes pods 均已部署，且返回值中 STATUS 的值为 Running：
    $ kubectl get pods -n istio-system

2.通过 Kubernetes Ingress 在外部已经可以访问httpserver应用。在这里不在赘述。

本readme描述通过 Istio Ingress Gateway 配置流量，以便在微服务中通过使用 Istio 控制流量。
Ingress Gateway 描述运行在网格边界的负载均衡器，负责接收传入的 HTTP/TCP 连接。其中配置了对外暴露的端口、协议等。但是，与Kubernetes Ingress 资源不同，Ingress Gateway 
不包含任何流量路由配置。Ingress 流量的路由使用 Istio 路由规则来配置，和内部服务请求完全一样。
1.创建 Istio Gateway：
$ kubectl apply -f - <<EOF
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: httpserver-gateway
spec:
  selector:
    istio: ingressgateway # use Istio default gateway implementation
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "http.example.com"
EOF
2.为通过 Gateway 的入口流量配置路由：
为 Istio Ingress Gateway 的主机名创建一个环境变量。
$ export NAMESPACE=wwt
$ export MY_INGRESS_GATEWAY_HOST=istio.$NAMESPACE.httpserver.com
配置 Istio Ingress Gateway：
$ kubectl apply -f - <<EOF
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: httpserver-gateway
spec:
  selector:
    istio: ingressgateway # use Istio default gateway implementation
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - $MY_INGRESS_GATEWAY_HOST
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: httpserver
spec:
  hosts:
  - $MY_INGRESS_GATEWAY_HOST
  gateways:
  - httpserver-gateway
  http:
  - match:
    - uri:
        prefix: /healthz
    route:
    - destination:
        port:
          number: 8000
        host: httpbin
EOF
